/* eslint-disable @next/next/no-img-element */
import { ImageResponse } from "next/og";
import { type NextRequest } from "next/server";

export const runtime = "edge";

export async function GET(req: NextRequest) {
  const { searchParams } = new URL(req.url);

  const logoOnly = searchParams.has("logoOnly")
    ? searchParams.get("logoOnly") === "1"
    : true;

  const includeTagline = searchParams.has("includeTagline")
    ? searchParams.get("includeTagline") === "1"
    : true;

  const tagline = searchParams.has("customTagline")
    ? searchParams.get("customTagline")
    : "Knowledgebase";

  const title = searchParams.has("title")
    ? searchParams.get("title")
    : "Aviate Educate Communicate";

  const logo_light = await fetch(
    new URL("../../../img/vACCLogo_en.png", import.meta.url),
  ).then((res) => res.arrayBuffer());

  const fontData = await fetch(
    new URL("../../../assets/OpenSans-Bold.ttf", import.meta.url),
  ).then((res) => res.arrayBuffer());

  const Logo = () => (
    <div
      tw={
        logoOnly
          ? "flex flex-col justify-center pt-28 pl-12 mx-auto"
          : "flex flex-col justify-center pt-6 pl-12"
      }
    >
      <img
        tw={logoOnly ? "w-1/2" : "w-1/4"}
        src={logo_light as unknown as string}
        alt="Latvia vACC"
      />
      {includeTagline && (
        <span
          tw={
            logoOnly
              ? "-ml-0.5 -mt-[4.5rem] max-w-[300px] text-5xl leading-none text-[#9d2235]"
              : "-ml-0.5 -mt-9 max-w-[245px] text-2xl leading-none text-[#9d2235]"
          }
          style={{ fontFamily: "OpenSans" }}
        >
          {tagline}
        </span>
      )}
    </div>
  );

  return new ImageResponse(
    (
      <div tw="flex flex-col h-full w-full justify-between bg-white">
        <Logo />
        <div tw="flex absolute w-full h-[65%]">
          <div tw="flex w-full items-center justify-center">
            <span
              tw={`text-${title!.length <= 35 ? 8 : title!.length <= 70 ? 7 : 6}xl text-center pb-3 mx-6 border-b-8 border-[#9d2235]`}
            >
              {!logoOnly ? title : ""}
            </span>
          </div>
        </div>
        <svg
          width="1920"
          height="703.99"
          version="1.1"
          viewBox="0 0 1062.9926 389.76376"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <clipPath id="a">
              <path d="m0 311.81h850.39v-311.81h-850.39v311.81z" />
            </clipPath>
          </defs>
          <g transform="matrix(1.25 0 0 -1.25 0 389.76)">
            <g clip-path="url(#a)">
              <g transform="translate(816.43 45.277)">
                <path d="m0 0 0.801 18.48 7.201 1.315 3.201-19.971-11.203 0.176zm-2.801 0.525-6.49 1.139 2.69 18.131 3.915-1.315-0.115-17.955zm-365.42 123.15-1.21-1.05v9.585l1.21 1.05v-9.585zm-1.958-1.05h-1.208v9.585h1.208v-9.585zm-2.42 0h-4.011v9.585h4.011v-9.585zm-5.221 0h-1.212v9.585h1.212v-9.585zm-1.974 0-1.209 1.05 0.015 9.585 1.21-1.05-0.016-9.585zm-43.461 14.999 1.76 5.131 1.76-5.131h-3.52zm-73.482-52.104-2.689-0.94v8.389l2.689 0.939v-8.388zm-4.118-0.94h-8.379v8.389h8.379v-8.389zm-9.808 0-2.689 0.94v8.388l2.689-0.939v-8.389zm-0.122 37.736 1.819-0.939v-5.679l-1.819 0.938v5.68zm2.786-0.939h5.908v-5.68h-5.908v5.68zm1.679 23.013h2.549v-3.157h-2.549v3.157zm5.197-23.013 1.817 0.939v-5.68l-1.817-0.938v5.679zm529.4-119.8-3.912-1.051-3.381 1.928-4.8-1.576-4.802 19.793-3.912 28.203-2.892 32.934-0.322 29.954-2.134 0.702-1.053 100.2-2.312-100.2-1.957-0.702-0.775-29.954-2.604-32.934-3.912-28.553s-3.912-18.568-4.446-18.216c-0.533 0.349-6.581 1.4-6.581 1.4s-3.401 1.547-4.623 1.576c-0.994 0.025-2.927-0.838-3.913-0.701-1.574 0.223-5.69 2.803-5.69 2.803s-1.194 0.617-2.551 1.183c-4e-3 2e-3 -8e-3 6e-3 -0.014 8e-3 -1.221 0.506-2.568 0.973-3.304 0.912-1.427-0.121-3.554-2.957-4.979-2.803-1.097 0.118-2.845 3.329-2.845 3.329l-0.356 5.429-34.5 1.576s-1.573-0.658-2.134-0.701c-2.295-0.17-8.18 1.403-9.069 1.578-0.89 0.176-15.65 3.678-16.538 3.678-0.889 0-4.98 1.928-4.98 1.928s-3.734 1.752-5.158 1.926c-1.421 0.173-3.201-0.174-3.201-0.174s-6.401-0.176-7.646 0.349c-1.247 0.526-1.417 2.528-1.956 3.329-1.096 1.626-4.981 3.679-5.869 5.255-0.887 1.577-0.06 1.973 0 2.627 0.084 0.901-1.599 2.803-2.312 2.803-0.711 0-3.34 0.775-4.268 1.402-1.764 1.19-4.803 5.08-5.868 6.131-1.068 1.051 2.312 2.278 1.779 3.678-0.535 1.402-0.636 3.041-1.245 3.854-0.721 0.96-3.556 2.277-4.269 2.277-0.712 0-3.498 0.07-4.622 0.351-1.091 0.272-3.735 1.577-4.27 1.401-0.532-0.176-6.935 2.805-8.713 2.805s-3.024-1.053-3.024-1.053l-3.511-3.328h-4.669l-4.934 40.949-4.86-40.949s-3.81-2.364-3.544-6.569c0.071-1.117 1.867-3.064 1.867-3.064v-1.315l-8.09-5.693-2.314-0.176 1.246 4.729-0.711 1.754-3.022 1.947v12.59h-19.985l-0.289 34.861-9.249-0.525-0.176-4.205 8.002-0.174 0.176-29.957h-13.534l-0.669 32.607-9.269-0.724-0.18-4.379 8.537-0.35 0.112-27.154h-4.557v-6.131s-1.779-0.525-1.779 0c0 0.527-2.063 2.519-3.202 2.277-0.854-0.181-1.598-2.625-1.598-2.625l-6.758 0.174s-3.197 3.223-4.446 2.803c-0.783-0.264-0.908-2.518-1.958-2.629-1.035-0.108-1.817 2.197-2.666 2.103-0.736-0.082-1.067-2.453-1.601-2.453-0.533 0-7.782-0.843-9.959 0.35-1.101 0.605-2.545 3.738-3.735 3.328-0.796-0.273-0.433-2.603-1.066-3.152-0.978-0.846-3.857-0.741-5.158-0.701-0.679 0.021-1.778 0.351-2.311 1.402-0.534 1.051-1.857 1.732-2.491 1.4-0.684-0.359-1.245-2.802-1.245-2.802s-4.427-1.18-5.688-0.524c-1.002 0.518-1.781 3.152-3.203 3.152s-1.26-1.171-1.778-1.402c-3.557-1.576-9.603-2.277-13.16-0.875-0.76 0.299-1.322 2.576-2.135 2.451-0.903-0.138-0.689-2.783-1.421-3.326-0.894-0.666-3.712-0.307-4.447 0.524-1.545 1.75-1.778 3.853-1.778 3.853l-2.489-4.203-12.804 0.176-0.18 0.023v30.272l0.502 1.482-0.687 2.316-0.595-2.21h-3.488v10.683s-1.694 5.324-2.488 7.008c-0.59 1.246-2.023 3.619-2.848 4.728-1.021 1.382-5.334 5.256-5.334 5.256v22.072h2.666s-3.159 3.343-3.732 4.73c-0.302 0.735-0.386 2.36-0.357 3.153 0.036 0.924 1.51 4.279 1.423 6.775-0.086 2.56-1.348 4.577-2.134 5.662-0.859 1.189-3.082 3.17-3.911 4.379-0.357 0.52-0.949 1.663-1.067 2.279-0.254 1.291 0.073 3.943 0 5.255-0.08 1.384-0.978 5.462-0.978 5.462l-1.011 15.116 0.347-0.152s0.874-0.085 1.133 0.067c0.481 0.281 1 2.464 1 2.464l-1.267 0.196s-1.2-0.624-1.2-0.099c0 0.527-0.9 0.657-0.9 0.657s-0.967 0.362-1.679 0.013c-0.711-0.351 0-0.702 0-0.702l1.246-1.226 0.34-0.56 0.191-0.317 0.333-0.144-1.023-15.313s-0.901-4.078-0.979-5.462c-0.072-1.312 0.251-3.964 0-5.255-0.119-0.616-0.71-1.759-1.065-2.279-0.831-1.209-3.054-3.19-3.915-4.379-0.785-1.085-2.044-3.102-2.134-5.662-0.085-2.496 1.391-5.851 1.424-6.775 0.029-0.793-0.051-2.418-0.356-3.153-0.571-1.387-3.731-4.73-3.731-4.73h2.663v-22.072s-4.309-3.874-5.335-5.256c-0.822-1.109-2.255-3.482-2.845-4.728-0.794-1.684-2.488-7.008-2.488-7.008v-10.683h-3.488l-0.595 2.21-0.688-2.316 0.503-1.482v-23.465l-8.002 13.664-5.158-10.16-0.596-0.239v13.135h2.155l-3.155 2.881s1.416 2.377 1.755 3.592c0.2 0.715 0.377 2.869 0 4.248-0.534 1.959-0.941 2.627-2.094 3.644-0.429 0.379-1.166 0.604-1.166 0.604v2.277l2.505 0.014-2.508 3.762-0.837 1.576-1.86 36.612s-0.966 1.26-1.219 1.751c-0.754 1.471-2.139 6.076-0.265 7.008 0.816 0.405 1.458 1.675 1.504 2.452 0.074 1.214-0.046 1.812-0.997 2.748-0.71 0.7-1.254 0.746-1.254 0.746l-1.425 17.001-1.425-17.001s-0.544-0.046-1.253-0.746c-0.953-0.936-1.073-1.534-0.998-2.748 0.045-0.777 0.689-2.047 1.504-2.452 1.876-0.932 0.489-5.537-0.266-7.008-0.251-0.491-1.22-1.751-1.22-1.751l-1.859-36.612-0.836-1.576-2.506-3.762 2.503-0.014v-2.277s-0.738-0.225-1.166-0.604c-1.155-1.017-1.561-1.685-2.094-3.644-0.378-1.379-0.2-3.533 0-4.248 0.34-1.215 1.755-3.592 1.755-3.592l-3.154-2.881h2.156v-20.254s-1.609-0.156-3.525-0.386l-6.078-0.665-8.359-3.328h-3.735s-7.646 1.403-8.18 1.227c-0.533-0.176-10.137-2.453-10.137-2.453l-9.356-2.305v-11.226h-4.042l-7.051 11.781v9.523l2.489-0.064-2.489 3.678s0.323 2.492 0.356 3.328c0.061 1.576 0.2 4.621 0.177 6.197-0.016 1.146-0.356 3.435-0.889 4.664-0.534 1.227-1.737 3.273-2.379 4.467-0.599 1.117-0.822 2.015-0.822 2.015v12.008l1.777 0.078-1.777 2.453s0.256 4.75 0 6.307c-0.136 0.82-1.411 4.805-2.135 6.306-0.22 0.461-1.066 1.751-1.066 1.751v10.16l1.244 0.088-0.71 2.365s-0.319 3.167-0.534 4.205c-0.388 1.874-2.135 7.357-2.135 7.357v9.81l0.957 0.01-1.491 3.143s0.266 0.953 0.358 1.401c0.095 0.472 0.158 1.471 0 1.927-0.165 0.472-1.067 1.928-1.067 1.928l-4.091 44.669-4.092-44.669s-0.901-1.456-1.067-1.928c-0.158-0.456-0.095-1.455 0-1.927 0.092-0.448 0.357-1.401 0.357-1.401l-1.49-3.143 0.956-0.01v-9.81s-1.746-5.483-2.134-7.357c-0.215-1.038-0.533-4.205-0.533-4.205l-0.712-2.365 1.245-0.088v-10.16s-0.845-1.29-1.067-1.751c-0.722-1.501-1.999-5.486-2.134-6.306-0.256-1.557 0-6.307 0-6.307l-1.778-2.453 1.778-0.078v-12.008s-0.221-0.898-0.822-2.015c-0.643-1.194-1.845-3.24-2.378-4.467-0.534-1.229-0.873-3.518-0.89-4.664-0.024-1.576 0.115-4.621 0.177-6.197 0.033-0.836 0.357-3.328 0.357-3.328l-2.492-3.678 2.492 0.064v-9.523l-69-2e-3 -8.004-11.211-1.956 0.701s-3.911 2.453-4.979 2.453c-1.066 0-4.802 2.102-5.868 2.102-1.067 0-11.915 2.629-11.915 2.629l-0.711 3.851-2.003 0.635-2.622 2.344-0.711 4.379-1.601 3.154-1.956 1.752-4.978 35.56-4.98-35.56-1.957-1.752-1.6-3.154-0.711-4.379s-11.736 2.277-12.626 2.277-5.869-2.451-6.402-2.629c-0.534-0.174-5.336 0.528-5.336 0.528l-7.646 1.751-3.557-1.226s-3.202-0.525-3.913-0.525c-0.71 0-2.489-0.528-2.489-0.528s-1.245 2.981-1.778 3.154c-0.534 0.174-4.624 2.102-4.624 2.102l-4.091 0.877-7.113 4.904-5.335 2.102-7.469 0.351-10.473 0.676-0.374 0.024-0.712 12.613 1.957 2.627-7.113 1.578-2.313 0.525 0.179 1.928 2.134 3.152 0.533 2.627 0.178 2.805-1.601 3.152-1.777 2.803-9.249 111.24 0.533 1.052-0.711 1.051-0.71 0.525-0.711-0.525-0.71-1.051 0.532-1.052-9.247-111.24-1.778-2.803-1.601-3.152 0.178-2.805 0.532-2.627 2.135-3.152 0.179-1.928-2.314-0.525-7.112-1.578 1.957-2.627-0.208-3.678-4.107-0.043 0.044-6.789-2.311-1.051-0.534-4.554s-0.356-6.832-0.356-7.883-1.245-2.104-1.245-2.104l-2.134-0.173-2.133-1.928-2.668-4.203-1.067-3.33s-2.134-1.926-2.668-2.102c-0.533-0.174-2.667 0-2.667 0h-4.091l-3.733-1.4-1.246-2.278-3.023-1.226-7.647 2.103-5.513 2.276-4.433 0.959v-87.752h850.39v47.142l-5.692-0.289z" />
              </g>
            </g>
          </g>
        </svg>
      </div>
    ),
    {
      width: 1920,
      height: 1080,
      statusText: "OK",
      status: 200,
      fonts: [
        {
          name: "OpenSans",
          data: fontData,
          style: "normal",
        },
      ],
    },
  );
}
